<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Previous Papers| AXONIX</title>

    <style>
        body{
          font-family: Arial;
          background:#f6f3ff;
          padding:40px;
        }
        h1{color:#62109F}
        .card{
          background:white;
          padding:20px;
          border-radius:14px;
          margin-bottom:20px;
          box-shadow:0 10px 24px rgba(165,148,249,.25);
        }
        .hidden{display:none}
        button{
          background:#A594F9;
          border:none;
          padding:10px 16px;
          color:white;
          border-radius:8px;
          cursor:pointer;
        }
        select,input{
          padding:8px;
          margin:6px;
        }
        .logout{
          position:fixed;
          top:20px;
          right:20px;
          background:#ff6b6b;
        }
        .file{
          display:flex;
          justify-content:space-between;
          margin:8px 0;
        }
        .logout{
          position:fixed;
          top:20px;
          right:20px;
          background:#ff6b6b;
        }

button{
          background:#A594F9;
          border:none;
          padding:10px 16px;
          color:white;
          border-radius:8px;
          cursor:pointer;
        }
    button{
          background:#A594F9;
          border:none;
          padding:10px 16px;
          color:white;
          border-radius:8px;
          cursor:pointer;
        }
         header{
          padding:18px 40px;
          display:flex;
          justify-content:space-between;
          align-items:center;
          background:rgba(255,255,255,0.85);
          backdrop-filter:blur(14px);
          position:sticky;
          top:0;
          z-index:1000;
          margin-bottom:10px;
          border-radius:10px;
        }
        .back-home{
          text-decoration:none;
          background:black;
          color:white;
          padding:10px 18px;
          border-radius:20px;
          font-size:14px;
          transition:.3s;
        }

        .back-home:hover{
          background:#8f7ef5;
          transform:translateY(-2px);
        }
    </style>
</head>

<body>

<header>
    <h1>PREVIOUS PAPERS </h1>
    <a href="/register.html" class="back-home">‚Üê Back to Home</a>
</header>

<!-- ================= STUDENT ================= -->
<div id="studentSection" class="hidden card">
    <h2> Search Here for Previuos Papers</h2>

    <select id="sUniversity">
        <option>JNTU</option>
        <option>OU</option>
    </select>

    <select id="sBranch">
        <option>CSE</option>
        <option>ECE</option>
    </select>

    <select id="sSemester">
        <option>SEM 1</option>
        <option>SEM 2</option>
    </select>

    <input id="sSubject" placeholder="Subject">

    <button onclick="loadStudentFiles()">Search</button>
    <button>Download</button>
    <div id="studentFiles"></div>
</div>

<!-- ================= TEACHER ================= -->
<div id="teacherSection" class="hidden">

    <div class="card">
        <h2>üì§ Upload Previous Papers</h2>

        <form id="uploadForm">
            <select name="university">
                <option>JNTU</option>
                <option>OU</option>
            </select>

            <select name="branch">
                <option>CSE</option>
                <option>ECE</option>
            </select>

            <select name="semester">
                <option>SEM 1</option>
                <option>SEM 2</option>
            </select>

            <input name="subject" placeholder="Subject" required>
            <input type="file" name="file" accept="application/pdf" required>

            <button>Upload</button>
        </form>
    </div>

    <div class="card">
        <h2>üìÅ Uploaded Previous Papers</h2>
        <a href="uploaded.html">click here to check uploaded previous papers</a>
        <div id="teacherFiles"></div>
    </div>

</div>
<script>
    /* ================= AUTH CHECK ================= */
    fetch("/auth/status")
      .then(res => res.json())
      .then(data => {

        if (!data.role || data.role === "NOT_LOGGED_IN") {
          alert("üîí Please login");
          location.href = "/register.html";
          return;
        }

        if (data.role === "ROLE_STUDENT") {
          document.getElementById("studentSection").classList.remove("hidden");
        }

        if (data.role === "ROLE_TEACHER") {
          document.getElementById("teacherSection").classList.remove("hidden");
          loadTeacherFiles();
        }
      });

    /* ================= STUDENT SEARCH ================= */
    function loadStudentFiles() {

      const university = document.getElementById("sUniversity").value;
      const branch = document.getElementById("sBranch").value;
      const semester = document.getElementById("sSemester").value;
      const subject = document.getElementById("sSubject").value;

      fetch(`/files/list?university=${university}&branch=${branch}&semester=${semester}&subject=${subject}`)
        .then(res => res.json())
        .then(files => {

          const box = document.getElementById("studentFiles");
          box.innerHTML = "";

          if (files.length === 0) {
            box.innerHTML = "<p>No PDFs found</p>";
            return;
          }

          files.forEach(f => {
            box.innerHTML += `
              <div class="file">
                <span>${f.filename}</span>
                <a href="/files/download/${f.id}">
                  <button>Download</button>
                </a>
              </div>`;
          });
        });
    }

    /* ================= TEACHER UPLOAD ================= */
    document.getElementById("uploadForm").addEventListener("submit", e => {
      e.preventDefault();

      const fd = new FormData(e.target);

      fetch("/files/upload", {
        method: "POST",
        body: fd
      })
      .then(res => {
        if (!res.ok) throw new Error();
        alert("‚úÖ Uploaded successfully");
        e.target.reset();
        loadTeacherFiles();
      })
      .catch(() => alert("‚ùå Upload failed"));
    });

    /* ================= TEACHER FILES ================= */
    function loadTeacherFiles() {

      // Teacher sees ALL files (can later filter if needed)
      fetch(`/files/list?university=JNTU&branch=CSE&semester=SEM 1&subject=`)
        .then(res => res.json())
        .then(files => {

          const box = document.getElementById("teacherFiles");
          box.innerHTML = "";

          if (files.length === 0) {
            box.innerHTML = "<p></p>";
            return;
          }

          files.forEach(f => {
            box.innerHTML += `
              <div class="file">
                <span>${f.filename}</span>
                <div>
                  <a href="/files/download/${f.id}">
                    <button>Download</button>
                  </a>
                  <button onclick="deleteFile(${f.id})">Delete</button>
                </div>
              </div>`;
          });
        });
    }

    /* ================= DELETE ================= */
    function deleteFile(id) {
      if (!confirm("Delete this PDF?")) return;

      fetch(`/files/delete/${id}`, { method: "DELETE" })
        .then(() => {
          alert("üóëÔ∏è Deleted");
          loadTeacherFiles();
        });
    }

     /* ================= LOGOUT ================= */
    function logout() {

          alert("üëã Logged out");
          location.href = "/register.html";

    }
</script>


</body>
</html>
